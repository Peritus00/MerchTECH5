# The entrypoint is the file that is shown when the Repl is opened.
entrypoint = "README.md"

# Specifies the environment modules to use.
modules = ["nodejs-20", "postgresql-16"]

[nix]
# The Nix channel to use for package management.
channel = "stable-24_05"

# --- SIMPLIFIED PORT CONFIGURATION ---
# The backend on 5001 will be accessed directly via its port.
# The frontend on 8081 is exposed as the main web service on port 80 (and 443 for HTTPS).

[[ports]]
localPort = 5001
# No external port needed; Replit will proxy to this port automatically.

[[ports]]
localPort = 8081
externalPort = 80

# --- WORKFLOWS ---
# This section defines what happens when you click the "Run" button
# or select a workflow from the dropdown.

# This sets the default action for the main "Run" button.
[workflows]
runButton = "Run App"

# This is now the ONLY workflow for running your application.
# It starts the backend and frontend in parallel for development.
[[workflows.workflow]]
name = "Run App"
mode = "parallel"

[[workflows.workflow.tasks]]
# Task 1: Start the stable backend server.
# It navigates to the 'server' directory and runs the corrected server file.
task = "shell.exec"
args = "node working-server.js"

[[workflows.workflow.tasks]]
# Task 2: Start the Expo frontend development server.
# It uses environment variables to communicate with the backend and Replit's proxy.
# --clear ensures the cache is cleared on startup to apply any changes.
task = "shell.exec"
args = "npx expo start --web --clear"

# --- DEPLOYMENT CONFIGURATION ---
# This tells Replit how to run your application when it's deployed.
[deployment]
# It will run only the stable working-server.js on the correct port.
run = ["sh", "-c", "node working-server.js"]

